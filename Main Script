9:03 AM BUILD

// VARIABLES ---------------------------------------------------------------------------------------------------------------

var id = getColumn("Pollution Table", "id");

var difficultyLevel = "";
var health = 100;
var dayCount = 1;

var marioStatus = "";
var damageToMario = 10;

// ELEMENTS --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

var carbonMonoxide = getColumn("Pollution Table", "CO(GT)");
var benzene = getColumn("Pollution Table", "C6H6(GT)");
var titaniumDioxide = getColumn("Pollution Table", "PT08.S2(NMHC)");

// FIXED ELEMENTS --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

// These lists include all of the data from 2004-2005 but have removed the "undefined" data that appears on page 19
var fixedCarbonMonoxide = [];
var fixedBenzene = [];
var fixedTitaniumDioxide = [];

// FUNCTIONS -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

// Filters the lists to remove the "undefined" data that code.org adds to the dataset
function filterRelavance(stopNumber){

  for (var i = 0; i < id[stopNumber]; i += 1){
    
    appendItem(fixedCarbonMonoxide, carbonMonoxide[i]);
    appendItem(fixedBenzene, benzene[i]);
    appendItem(fixedTitaniumDioxide, titaniumDioxide[i]);
  }
}

// Because traversing through around 10,000 elements can take some time, there is a loading screen
function startGameNow(){
  
  // Alerts the user the game has finished loading
  playSound("sound://category_bell/vibrant_game_slot_machine_ding_1.mp3");
  setText("loadingText", "Get Ready!");
  
  setTimeout(function(){
    
    // Redirects the user to the start screen
    setScreen("mainTitle");
  }, 2000);
}

// Not necessary but it sort of adds realism in which this app really feels like a game 
function transitionAssets(){
  
  // Stops the main page background music
  stopSound("Cursed-Nintendo-Images-but-with-Super-Mario-Bros-music.mp3");
  playSound("sound://category_bell/vibrant_game_slot_machine_ding_1.mp3");
  
  // Redirects the user to the loading screen
  setScreen("loadingScreen");
  setText("loadingText", "Loading ...");

  // After around 2000 ms (2 seconds)
  setTimeout(function(){
    
    playSound("Coconut-Mall-ed.mp3", true);
    
    // Redirects the user to the game screen (actual content)
    setScreen("gameScreen");
  }, 2000);
}

// LEFT CASTLE ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function leftCastle(){
  
  // Prevent the user from clicking the button again before the function finishes
  setProperty("stayHomeButton", "hidden", true);
  setProperty("outButton", "hidden", true);
  
  // Checks to see if you choose the easy difficulty
  if (difficultyLevel == "benzene"){
    
    // Selects a randomBezene value frome the air pollution table
    var randomBenzene = fixedBenzene[randomNumber(0, fixedBenzene.length - 1)];
    
    // Mario's resistance to the pollution
    var marioResistance = 5;
    damageToMario = damageToMario * 1;
    
    // If the benzene value is greater than Mario's abilty to resist the pollution
    if (marioResistance < randomBenzene){
      
      // Mario takes damage
      health = health - damageToMario;
      
      // Runs the marioIsHurt function 
      marioIsHurt();
      
      // After 1 second, return Mario back to the castle and make the buttons reappear for the user
      setTimeout(finishDebounce, 1000);
    }
  
    else if (marioResistance >= randomBenzene){
      // Mario gains health equal to the amount of damage he would have taken if he does not have 100 health already
      if (health != 100){
        health = health + damageToMario;
      }
      
      // Runs the marioSurvives function
      marioSurvives();
      
      // After 1 second, return Mario back to the castle and make the buttons reappear for the user
      setTimeout(finishDebounce, 1000);
    }
  }
  
  
  
}

// STAYED HOME -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

function stayedHome(){
  
  
  
}

// -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

// A hurt Mario sprite shows up to alert the user of their actions
function marioIsHurt(){

  setProperty("marioCastle", "hidden", true);
  setProperty("hurtMario", "hidden", false);
}

// A  Mario sprite shows at the grocery store to alert the user of their actions 
function marioSurvives(){

  setProperty("marioCastle", "hidden", true);
  setProperty("marioStore", "hidden", false);
}

// Function to make the buttons reappear, display how many day's you've survived, or directs to the game over screen
function finishDebounce(){
  
  if (health > 0){
    
    // Increases you day count by one
    dayCount += 1;  
    setProperty("elementLabel", "text", difficultyLevel + "(Day " + dayCount + ")");
    
    setProperty("marioCastle", "hidden", false);
    setProperty("hurtMario", "hidden", true);
    setProperty("marioStore", "hidden", true);

    setProperty("stayHomeButton", "hidden", false);
    setProperty("outButton", "hidden", false);

  }
  
  else{
    stopSound("Coconut-Mall-ed.mp3");
    
    playSound("Sad-Song---Super-Mario-RPG.mp3", true);
    setScreen("gameOverScreenie");
  }
}

// MAIN SETUP ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

// Runs the filterRelavance function
filterRelavance(9356);

// Removes the user from the loading screen
startGameNow();
playSound("Cursed-Nintendo-Images-but-with-Super-Mario-Bros-music.mp3", true);

// Start button is clicked
onEvent("beginButton", "click", function(){
  
  // You are sent to the select difficulty screen
  playSound("sound://category_bell/vibrant_game_slot_machine_ding_1.mp3");
  setScreen("difficultyScreen");
});

// -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

// You have chosen easy difficulty, Mario has high benzene resistance
onEvent("easyButton", "click", function(){
  
  transitionAssets();

  // Tells the program what element it needs to analyse from the dataset
  difficultyLevel = "benzene";
});

// You have chosen intermediate difficulty, Mario is new to this pollutant
onEvent("midButton", "click", function(){
  
  transitionAssets();

  // Tells the program what element it needs to analyse from the dataset
  difficultyLevel = "CO";
});

// You have chosen hard difficulty, Titanium Dioxide is Mario's weakness
onEvent("intenseButton", "click", function(){
  
  transitionAssets();
  
  // Tells the program what element it needs to analyse from the dataset
  difficultyLevel = "tDioxide";
});

// Sends you back to the main page
onEvent("backButton", "click", function(){
  
  playSound("sound://category_bell/vibrant_game_slot_machine_ding_1.mp3");
  setScreen("mainTitle");
});

// -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

onEvent("outButton", "click", leftCastle);
onEvent("stayHomeButton", "click", stayedHome);

// WORKS CITED ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

var documentation = "https://github.com/Larrieeee/Hackathon-COCO-M";
console.log("Documentation: " + documentation);

